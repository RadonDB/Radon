Table of Contents
=================

   * [Table of Contents](#table-of-contents)
   * [事务和锁语句](#事务和锁语句)
      * [事务](#事务)
   * [其它](#其它)
      * [使用自增](#使用自增)
      * [流式获取](#流式获取)
         * [读写分离](#读写分离)
   * [全文索引](#全文索引)
      * [ngram全文索引解析器](#ngram全文索引解析器)

# 事务和锁语句

## 事务
`Syntax`
```
BEGIN
COMMIT
ROLLBACK
```

`说明`
 * 多语句事务
 * RadonDB 两阶段事务提交(twopc-enable ON)开关必须开启
 * RadonDB 支持单语句事务自动提交(twopc-enable ON)

`示例: `
```
mysql> create table txntbl(a int);
Query OK, 0 rows affected (0.01 sec)

mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into txntbl(a) values(1),(2);
Query OK, 4 rows affected (0.00 sec)

mysql> select * from txntbl;
+------+
| a    |
+------+
|    1 |
|    2 |
+------+
2 rows in set (0.01 sec)

mysql> rollback;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from txntbl;
Empty set (0.00 sec)

mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into txntbl(a) values(1),(2);
Query OK, 4 rows affected (0.00 sec)

mysql> commit;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from txntbl;
+------+
| a    |
+------+
|    1 |
|    2 |
+------+
2 rows in set (0.00 sec)

```


# 其它
## 使用自增

`说明`
* RadonDB 使用golang的UnixNano()值作为自己的唯一标识
* AUTO_INCREMENT字段必须是BIGINT.

`示例: `

```
mysql> CREATE TABLE animals (
    ->      id BIGINT NOT NULL AUTO_INCREMENT,
    ->      name CHAR(30) NOT NULL,
    ->      PRIMARY KEY (id)
    -> ) PARTITION BY HASH(id);
Query OK, 0 rows affected (0.14 sec)

mysql> INSERT INTO animals (name) VALUES
    ->     ('dog'),('cat'),('penguin'),
    ->     ('lax'),('whale'),('ostrich');
Query OK, 6 rows affected (0.01 sec)

mysql> SELECT * FROM animals;
+---------------------+---------+
| id                  | name    |
+---------------------+---------+
| 1553090617754346084 | lax     |
| 1553090617754346082 | cat     |
| 1553090617754346085 | whale   |
| 1553090617754346081 | dog     |
| 1553090617754346083 | penguin |
| 1553090617754346086 | ostrich |
+---------------------+---------+
6 rows in set (0.02 sec)
```

## 流式获取

`说明`
* 当查询结果集特别大的时候，结果集可以流式获取以避免爆内存。
* 方式1: 执行`set @@ SESSION.radon_streaming_fetch = 'ON'` 来打开流式获取开关，当查询执行完毕后, 执行`set @@ SESSION.radon_streaming_fetch = 'OFF'`关闭流式获取。
* 方式2: 在查询语句中增加hint `/*+ streaming */`。
* *不支持复杂查询*

`示例: `

```
mysql> select /*+ streaming */ * from t1;
Empty set (0.00 sec)
```

### 读写分离

`说明`
* 如果 `load-balance` 为`1`, 这条查询可以被路由到备节点。
* 这条查询必须是读并且不在多语句事务中。
* 通过使用hint`/*+ loadbalance=0 */`, 这条查询会被强制在写节点执行。
* 通过使用hint`/*+ loadbalance=1 */`, 这条查询会被强制在备份节点执行。

`示例: `

```
mysql> select /*+ loadbalance=0 */ * from t1;
Empty set (0.00 sec)

mysql> select /*+ loadbalance=1 */ * from t1;
Empty set (0.00 sec)
```

# 全文索引
##  ngram全文索引解析器

`说明`
* RadonDB 支持全文索引，提供一个ngram 全文索引解析器(支持中文, 日语, 和韩语(CJK))。
* RadonDB 全文索引表是分区的(MySQL分区表不支持全文索引)，并且查询是并行执行的。

`示例: `

```
mysql>CREATE TABLE `articles` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(200) DEFAULT NULL,
  `body` text,
  PRIMARY KEY (`id`),
  FULLTEXT INDEX `ngram_idx` (`title`,`body`) WITH PARSER ngram
) ENGINE=InnoDB PARTITION BY HASH(id);

mysql>INSERT INTO articles (title,body) VALUES
    ('数据库管理','在本教程中我将向你展示如何管理数据库'),
    ('数据库应用开发','学习开发数据库应用程序');


SELECT title from articles  WHERE MATCH (title, body) AGAINST ('数据库' IN BOOLEAN MODE);
+-----------------------+
| title                 |
+-----------------------+
| 数据库应用开发        |
| 数据库管理            |
+-----------------------+
2 rows in set (0.04 sec)
```
