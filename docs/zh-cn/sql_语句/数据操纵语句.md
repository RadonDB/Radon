Table of Contents
=================

   * [数据操纵语句](#数据操纵语句)
      * [DELETE 语句](#delete-语句)
      * [INSERT 语句](#insert-语句)
      * [REPLACE 语句](#replace-语句)
      * [SELECT 语句](#select-语句)
      * [UPDATE 语句](#update-语句)

# 数据操纵语句

## DELETE 语句

`语法`
```
DELETE  FROM tbl_name
    [WHERE where_condition]
```

`说明`
 * 支持分布式事务，以确保跨分区删除原子性
 *  *不支持没有WHERE条件的删除*
 *  *不支持子句*

`示例: `
```
mysql> DELETE FROM t1 WHERE id=1;
Query OK, 2 rows affected (0.01 sec)
```

## INSERT 语句

`语法`
```
INSERT INTO tbl_name
    (col_name,...)
    {VALUES | VALUE}
```

`说明`
 * 支持分布式事务以确保跨分区写原子性
 * 支持插入多个值，这些值可以在不同的分区中
 * 必须指定插入列列名
 *  *不支持子句*

`示例: `
```
mysql> INSERT INTO t2(id, age) VALUES(1, 24), (2, 28), (3, 29);
Query OK, 3 rows affected (0.01 sec)
```

## REPLACE 语句

`语法`
```
REPLACE INTO tbl_name
    [(col_name,...)]
    {VALUES | VALUE} ({expr | DEFAULT},...),(...),...
```

`说明`
 * 支持分布式事务以确保跨分区写原子性
 * 支持插入多个值，这些值可以在不同的分区中
 * 必须指定replace列名

`示例: `
```
mysql> REPLACE INTO t2 (id, age) VALUES(3,34),(5, 55);
Query OK, 2 rows affected (0.01 sec)
```

## SELECT 语句

`语法`
```
SELECT
    [DISTINCT]
    select_expr [, select_expr ...]
    [FROM table_references
    [WHERE where_condition]
    [GROUP BY {col_name}
    [HAVING where_condition]
    [ORDER BY {col_name}
      [ASC | DESC], ...]
    [LIMIT {[offset,] row_count | row_count OFFSET offset}]
```

`JOIN`
```
table_references:
    escaped_table_reference [, escaped_table_reference] ...
escaped_table_reference:
    table_reference
  | { OJ table_reference }
table_reference:
    table_factor
  | join_table
table_factor:
    [schema_name.]tbl_name [[AS] alias]
  | ( table_references )
join_table:
    table_reference [INNER | CROSS] JOIN table_factor [join_condition]
  | table_reference {LEFT|RIGHT} [OUTER] JOIN table_reference join_condition
join_condition:
    ON conditional_expr
```

`UNION`
``` 
SELECT ...
UNION [ALL | DISTINCT]
SELECT ...
[UNION [ALL | DISTINCT]
SELECT ...]
```

`说明`

 * 支持跨分区计数，求和，平均，最大值，最小值和其他聚合函数，聚合函数仅支持数字值
 * 支持分区order by，group by，limit和其他操作，*group by字段必须在select_expr中*
 * 建议Group by 和聚集函数一起使用, 返回非`group by`字段时，避免单独使用group by。
 * 支持复杂的查询，例如联接
 * 支持where和having子句，暂时不支持聚合功能。
 * 支持在不引用任何表的情况下检索计算的行，或者在没有引用表的情况下将`DUAL`指定为虚拟表名。
 * 为诸如`SELECT columna [[AS] alias] FROM mytable;`之类的列支持别名。
 * 支持表的别名，例如`SELECT columna FROM tbl_name [[AS] alias];`。
 * 支持LEFT | RIGHT OUTER和INNER | CROSS联接。
 * 不推荐使用`select *`，特别是在join语句中。
 * 支持UNION [ALL | DISTINCT].
 

`示例: `
```
mysql> CREATE TABLE t2(id int, age int) partition by HASH(id);
Query OK, 0 rows affected (1.78 sec)

mysql> INSERT INTO t2(id, age) values(1, 25);
Query OK, 1 row affected (0.01 sec)

mysql> INSERT INTO t2(id, age) values(3, 22);
Query OK, 1 row affected (0.01 sec)

mysql> INSERT INTO t2(id, age) values(13, 22);
Query OK, 1 row affected (0.02 sec)

mysql> INSERT INTO t2(id, age) values(23, 22);
Query OK, 1 row affected (0.00 sec)

mysql> select id, sum(id) from t2 group by id order by id desc limit 10;
+------+---------+
| id   | sum(id) |
+------+---------+
|   23 |      23 |
|   13 |      13 |
|    3 |       3 |
|    1 |       1 |
+------+---------+
4 rows in set (1.048 sec)
```


SELECT可用于检索不参考任何表而计算的行：

```
mysql> select 1 + 1;
+-------+
| 1 + 1 |
+-------+
|     2 |
+-------+
1 row in set (0.00 sec)
```

在没有引用表的情况下，将`DUAL`指定为虚拟表名称：

```
mysql> select date_format(now(),'%y-%m-%d') FROM DUAL;
+-------------------------------+
| date_format(now(),'%y-%m-%d') |
+-------------------------------+
| 18-06-18                      |
+-------------------------------+
1 row in set (0.00 sec)
```

带有别名的SELECT，`AS`是可选的：

```
mysql> select id ID from t2 testTbl;
+------+
| ID   |
+------+
|    3 |
|   23 |
|    1 |
|   13 |
+------+
4 rows in set (0.02 sec)
```

```
mysql> select testTbl.id as ID from t2 as testTbl;
+------+
| ID   |
+------+
|    3 |
|   23 |
|    1 |
|   13 |
+------+
4 rows in set (0.02 sec)
```

用`JOIN`进行SELECT时，不能被下推的join语句在`selectexpr`中不能有`*`。

```
mysql> CREATE TABLE t1(id int, age int) partition by HASH(id);
Query OK, 0 rows affected (1.127 sec)

mysql> INSERT INTO t1(id, age) values(1, 22),(2,25),(3,22),(4,25);
Query OK, 4 row affected (0.197 sec)

mysql> select id, sum(id) from t2 group by id order by id desc limit 10;
+------+---------+
| id   | sum(id) |
+------+---------+
|   23 |      23 |
|   13 |      13 |
|    3 |       3 |
|    1 |       1 |
+------+---------+
4 rows in set (1.048 sec)

mysql> select * from t1 join t2 on t1.id=t2.id where t2.age=22;
+------+------+------+------+
| id   | age  | id   | age  |
+------+------+------+------+
|    3 |   22 |    3 |   22 |
+------+------+------+------+
1 row in set (1.082 sec)

mysql> select t1.id, t1.age,t2.id from t1 join t2 on t1.age=t2.age where t2.id > 10 order by t1.id;
+------+------+------+
| id   | age  | id   |
+------+------+------+
|    1 |   22 |   23 |
|    1 |   22 |   13 |
|    3 |   22 |   23 |
|    3 |   22 |   13 |
+------+------+------+
4 rows in set (1.056 sec)

mysql> select * from t1 join t2 on t1.age=t2.age where t2.id > 10 order by t1.id;
ERROR 1105 (HY000): unsupported: '*'.expression.in.cross-shard.query

mysql> select * from t1 union select * from t2 order by id limit 1;
+------+------+
| id   | age  |
+------+------+
|    1 |   25 |
+------+------+
1 row in set (1.012 sec)
```

## UPDATE 语句

`语法`
```
UPDATE table_reference
    SET col_name1={expr1|DEFAULT} [, col_name2={expr2|DEFAULT}] ...
    [WHERE where_condition]
```

`说明`
 * 支持分布式事务以确保跨分区写原子性
 * *不支持无where条件更新*
 * *不支持更新分区键*
 * *不支持子句*

`示例: `
```
mysql> UPDATE t1 set age=age+1 WHERE id=1;
Query OK, 1 row affected (0.00 sec)
```
